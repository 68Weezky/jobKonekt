<div class="min-h-screen bg-beige">
    <!-- Drawer -->
    <div class="drawer">
        <input id="drawer-toggle" type="checkbox" class="drawer-toggle" />
        <!-- Drawer Content -->
        <div class="drawer-content">
            <%- include('header') %>
            <!-- Page Content -->
            <div class="container mx-auto p-4">
                <h1 class="text-2xl font-bold mb-6">Available Service Providers</h1>
                <!-- Search and Filter Controls -->
                <div class="mb-4 flex flex-col md:flex-row md:items-center md:gap-4">
                    <input type="text" id="serviceSearch" class="input input-bordered w-full md:w-1/3 mb-2 md:mb-0" placeholder="Search by name or area...">
                    <div class="flex flex-wrap gap-4 items-center">
                        <label class="flex items-center gap-1">
                            <input type="radio" name="roleFilter" value="all" checked> All
                        </label>
                        <label class="flex items-center gap-1">
                            <input type="radio" name="roleFilter" value="janitor"> Janitor
                        </label>
                        <label class="flex items-center gap-1">
                            <input type="radio" name="roleFilter" value="carpenter"> Carpenter
                        </label>
                        <label class="flex items-center gap-1">
                            <input type="radio" name="roleFilter" value="electrician"> Electrician
                        </label>
                        <label class="flex items-center gap-1">
                            <input type="radio" name="roleFilter" value="plumber"> Plumber
                        </label>
                    </div>
                </div>
                <div id="serviceCards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <% users.forEach(function(user) { %>
                        <div class="card bg-base-100 shadow-xl flex flex-row items-center p-4 service-card relative" data-role="<%= user.role %>" data-username="<%= user.username.toLowerCase() %>" data-area="<%= (user.residential_area || '').toLowerCase() %>">
                            <!-- Left: Profile Picture -->
                            <div class="service-photo flex-shrink-0 flex items-center justify-center mr-4" style="width: 90px; height: 90px;">
                                <% if (user.profile_picture) { %>
                                    <img src="<%= user.profile_picture %>" alt="<%= user.username %>" class="object-cover w-full h-full rounded-full border-2 border-blue-600" />
                                <% } else { %>
                                    <span class="text-3xl text-gray-400 bg-gray-200 w-full h-full flex items-center justify-center rounded-full border-2 border-blue-600">
                                        <%= user.username ? user.username[0].toUpperCase() : '?' %>
                                    </span>
                                <% } %>
                            </div>
                            <!-- Right: User Details -->
                            <div class="flex-1 flex flex-col justify-between h-full pr-2">
                                <div>
                                    <h2 class="font-bold text-lg mb-1"><%= user.username %></h2>
                                    <div class="text-sm text-gray-600 mb-1">Role: <span class="font-semibold"><%= user.role %></span></div>
                                    <div class="text-sm text-gray-600 mb-1">Residential Area: <span class="font-semibold"><%= user.residential_area || 'N/A' %></span></div>
                                    <div class="text-sm text-gray-600 mb-1">Rating: 
                                        <% if (user.rating) { %>
                                            <span class="font-semibold">
                                                <% for(let i=1; i<=5; i++) { %>
                                                    <% if (i <= Math.round(user.rating)) { %>
                                                        <span class="star selected">&#9733;</span>
                                                    <% } else { %>
                                                        <span class="star">&#9733;</span>
                                                    <% } %>
                                                <% } %>
                                                <%= user.rating %>/5
                                            </span>
                                        <% } else { %>
                                            <span class="font-semibold">No ratings yet</span>
                                        <% } %>
                                    </div>
                                    <div class="text-xs text-gray-500">
                                        <% if (user.latest_review) { %>
                                            <span class="italic">"<%= user.latest_review %>"</span>
                                            <span class="ml-2">- <%= user.latest_review_rating %>/5</span>
                                            <span class="ml-2 text-gray-400">(<%= user.latest_review_date.toLocaleDateString ? user.latest_review_date.toLocaleDateString() : user.latest_review_date %>)</span>
                                        <% } else { %>
                                            No reviews yet
                                        <% } %>
                                    </div>
                                </div>
                                <!-- Button group pinned to bottom right -->
                                <div class="card-actions-bottom">
                                    <form action="/servicerequest" method="get" style="display:inline;">
                                        <input type="hidden" name="professional_id" value="<%= user.id %>">
                                        <button type="submit" class="btn btn-primary" <% if (user_logged_in && user.id === user_logged_in.id) { %>disabled title="You cannot request service from yourself"<% } %>>Request Service</button>
                                    </form>
                                    <a href="/ratings?user_id=<%= user.id %>" class="btn btn-secondary" <% if (user_logged_in && user.id === user_logged_in.id) { %>disabled title="You cannot rate yourself"<% } %>>Rate</a>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
            <%- include('footer') %>
        </div>
        <!-- Drawer Side -->
        <%- include('drawer') %>
    </div>
</div>

<!-- Add services.js for filtering -->
<script src="/js/services.js"></script> 